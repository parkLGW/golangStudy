# 标题

## 计算机网络

* 功能：数据通信、资源共享、分布式处理、提高可靠性、负载均衡
* 带宽：最高数据传输速率
* 广播式网络共享广播信道，通常是局域网的一种通信方式（路由器隔离广播域）
* 计算机网络每一层实体中，报文可分为：数据部分（服务数据单元PDU）+控制信息部分（协议控制信息PCI）=协议数据单元PDU
  * 物理层的PDU称为比特
  * 数据链路层的PDU称为帧
  * 网络层的PDU称为分组
  * 传输层的PDU称为报文段
* 协议：由**语法、语义和同步**三部分组成；一个完整的协议通常应具有线路管理、差错控制、数据转换等功能
* 接口：相邻两层实体通过服务访问点SAP进行交互，服务通过SAP提供给上层使用
* 服务原语：请求、指示、响应、证实
* 可靠服务与不可靠服务
  * 可靠服务：指网络具有纠错、检错、应答机制，能确保数据正确、可靠地传送到目的地
  * 不可靠服务：网络只是尽量正确、可靠地传送
* ISO/OSI参考模型
  * 物理层（比特流）：在物理媒体上为数据端设备透明地传输原始比特流、
  * 数据链路层（帧）：成帧、差错控制、流量控制、传输管理
    * SDLC
    * HDLC
    * PPP
    * STP
  * 网络层（数据报）：对分组进行路由选择，差错控制、流量控制、拥塞控制、网际互连
    * IP
    * IPX
    * ICMP
    * IGMP
    * ARP
    * RARP
    * OSPF
  * 传输层（报文段TCP或用户数据报UDP）：差错控制、流量控制、服务质量、数据传输管理
    * TCP
    * UDP
  * 会话层：为表示层实体或用户进程建立连接并在连接上有序传输数据，即会话，也称建立同步
  * 表示层：处理在两个通信系统中交换信息的表示方式。数据压缩、加密解密
  * 应用层：用户与网络的界面
    * FTP
    * SMTP
    * HTTP
* TCP/IP模型
  * 网络接口层（对应OSI物理层和链路层）：从主机或结点接收IP分组，并把它们发送到指定物理网络上
  * 网际层
  * 传输层
  * 应用层（对应OSI会话层、表示层和应用层）

**OSI在网络层支持无连接和面向连接的通信，但在传输层仅有面向连接的通信；TCP/IP在网际层仅有一种无连接的通信，但传输层支持无连接和面向连接两种模式**

> * 世界第一个计算机网络ARPAnet，Internet起源于它

### 物理层

#### 通信基础

* **码元**：用一个固定市场的信号波形表示以为k进制数字 ————————————————————》

* 信源是产生和发送数据的源头，信宿是接收数据的终点，信道是信号传输的媒介

  信道的极限容量指信道的最高码元传输速率或信道的极限信息传输速率

* 码元传输速率（波特率）：单位时间内数字通信系统传输的码元个数（或信号变化次数）单位是波特Baud

  信息传输速率（比特率）：单位时间内数字通信系统传输的二进制码元个数

* 奈奎斯特定理：理想低通信道下的极限数据传输速率=2Wlog<sub>2</sub>V 

  * W为理想低通信道的带宽，V是每个码元离散电平的数目（如4个二进制位的数目位16）

* 香农定理：信道的极限数据传输速率=Wlog<sub>2</sub>(1+S/N)

  * W为信道带宽，S为信道所传输信号的平均功率，N为信道内部的高斯噪声功率
  * 信噪比=10log<sub>10</sub>(S/N) dB

* 编码与调制

  把数据变为模拟信号的过程称为调制，把数据变为数字信号的过程称为编码

  * 数字数据->数字信号：

    * 归零编码：高1低0中间归零（有同步机制）
    * 非归零编码：高1低0（无同步机制）
    * 反向非归零编码：翻转0不变1（可同步）
    * 曼彻斯特编码：前高后低为1，前低后高为0（可同步）**以太网使用此编码**
    * 差分曼彻斯特编码：上一码元的后半个码元与当前码元的前半个码元相同为1，否则为0（可同步）**常用于局域网传输**

  * 数字数据->模拟信号:

    * 幅移键控（ASK）
    * 频移键控（FSK）：抗干扰强
    * 相移键控（PSK）
    * 正交振幅调制（QAM）：频率相同的前提下，将ASK和PSK结合起来。设波特率为B，m个相位，每个相位n种振幅，则数据传输速率R=Blog<sub>2</sub>(mn)

  * 模拟数据->数字信号：

    常用于对音频信号进行编码的脉码Z（PCM），包括采样、量化和编码。采样频率必须大于等于原始信号最大频率的两倍（奈奎斯特采样定理）

  * 模拟数据->模拟信号

* 电路交换、报文交换和分组交换

  * 电路交换：

    * 优点：时延小、有序、无冲突、适用范围广、实时、控制简单
    * 缺点：建立连接时间长、线路独占、灵活性差、难规格化,不提供差错控制

  * 报文交换：

    * 优点：无连接、动态分配路线、线路可靠性和利用率高，提供多目标服务
    * 缺点：时延长、要求网络节点有较大缓存空间

  * 分组交换：

    * 优点：无建立时延、线路利用率高、简化了存储管理、加速传输、出错概率减小
    * 缺点：存在传输时延、需传输额外信息量

    >* 数据报方式：每个分组携带目的地址，无连接，不可靠，无序，能应对故障，资源利用率高
    >* 虚电路：数据分组要有分组号、校验和、虚电路号；有连接，可靠有序，流量控制（分为永久型和交换型）

#### 传输介质

* 双绞线：局域网中普遍使用，模拟传输和数字传输都可以使用
* 同轴电缆：局域网中应用广泛，具有更高的屏蔽性
* 光纤：
  * 多模光纤：适合近距离传输，光源为发光二极管
  * 单模光纤：直径只有一个光的波长
* 物理层接口特性：
  * 机械特性：指明接口所用接线器的形状和尺寸、引脚数目和排列、固定和锁定装置
  * 电气特性：指明电压范围
  * 功能特性：指明某电平的电压表示何种意义
  * 规程特性：指明对于不同功能的各种可能事件的出现顺序

#### 物理层设备

* 中继器：将信号整形并放大再转发出去

  > * 中继器两端的网段必使用同一个协议
  > * 10BASE5以太网符合5-4-3规则：5个网段-4个中继器-3个网段可挂计算机

* 集线器Hub：多端口中继器

  > * 主要使用双绞线，每个端口连接的网络部分是同一个网络的不同网段
  > * 只能在半双工状态下工作

* 两个网段在物理层进行互联时要求数据传输速率相同（因为没有流量控制），但数据链路层协议可以不同，但如果要保证可以互相传送数据链路层的帧，则数据链路层协议要相同

  **本层及本层一下协议必须相同，本层以上协议可以不同**

### 数据链路层

#### 数据链路层功能

* 为网络层提供服务

  * 无确认的无连接服务：适用于实时通信或误码率较低的通信信道，如以太网
  * 有确认的无连接服务：适用于误码率较高的通信信道，如无线通信
  * 有确认的面向连接服务：适用于通信要求（可靠性、实时性）较高的场合

  有连接就一定要有确认，**不存在无确认的面向连接服务**

* 链路管理

  数据链路层连接的建立、维持和释放，主要用于面向连接的服务、

* 帧定界、帧同步、透明传输

  * 帧定界：首部和尾部含有很多控制信息，一个重要作用就是确定帧的界限
  * 帧同步：接收方应能从接收到的二进制比特流中区分出帧的起始与终止
  * 透明传输：不管所传数据是什么样的比特组合，都应当能在链路上传送

* 流量控制

  限制发送方的数据流量，使其发送速率不超过接收方的接受能力

* 差错控制

  用以使发送方确定接收方是否正确收到其发送的数据的方法

#### 组帧

* 字符计数法
* 字符填充的首尾界定符法：使用特定字符定界一帧的开始和结束（SOH表示帧首部，EOT帧结束，ESC转义字符）
* 零比特填充的首位标志法：01111110标志一帧的开始和结束，连续五个1则插入一个0
* 违规编码法

#### 差错控制

* 检错编码：都采用冗余编码技术
  * **奇偶校验码**：n-1位信息元和1位校验元。1的个数为奇数是奇校验码，1的个数为偶数是偶校验码。只能检测奇数位的出错情况，但并不知道哪些位出错。
  * **循环校验码CRC**
    * 具有纠错功能，但数据链路层仅使用了它的检错功能；
    * **带r个校验位的多项式编码可以检测到所有长度小于等于r的突发性错误**；
    * 可以用硬件完成
* 纠错编码
  * **海明码**
    * 信息位n和校验位k，**n+k<=2<sup>k</sup>-1**（若要检测两位错，则需要再增加1位校验位）
    * 纠错d位，需要<font color='red'>码距</font>为2d+1的编码方案，检错d位，只需码距为d+1

#### 流量控制与可靠传输

* 流量控制、可靠传输与滑动窗口机制

  * 停止等待协议：每次只允许发送一帧，然后陷入等待接收方确认信息的过程中
  * 滑动窗口
    * 只有接收窗口向前滑动时，发送窗口才有可能向前滑动
    * 接收窗口大小为1时，可保证帧的有序接收
    * 数据链路层的滑动窗口协议中，窗口大小在传输过程中是固定的
  * 可靠传输机制
    * 数据链路层的可靠传输通常使用确认和超时重传两种机制完成
    * **自动请求重传ARQ**通过接收方请求发送方重传出错的数据帧来恢复出错的帧

* 停止等待协议

  发送窗口和接收窗口大小均为1

  * 发送的帧交替地用0和1标识
  * 发送方和接收方都须设置一个帧缓冲区

* 后退N帧协议

  * 接收方检测出失序地信息帧后，要求发送方重发最后一个正确接收的信息帧之后所有未被确认帧，接收方只允许按序接收帧
  * 若用n比特对帧编号，则发送窗口的尺寸**1<=W<sub>T</sub><=2<sup>n</sup>**

* 选择重传协议（SR）

  * 一旦接收方怀疑帧出错，就会发一个否定帧NAK给发送方，要求发送方对NAK中指定的帧进行重传
  * 若采用n比特对帧编号。则**接收窗口W<sub>R</sub>+发送窗口W<sub>T</sub><=2<sup>n</sup>**；一般接收窗口和发送窗口大小相同

* 信道吞吐率=信道利用率x发送方的发送速率

#### 介质访问控制

* 信道划分介质访问控制：将使用介质的每个设备与来自同一通信信道上的其他设备的通信隔离开来。实质就是通过分时、分频、分码等方法把广播信道转变成点对点信道

  * **频分多路复用（FDM）**：每个子信道分配的带宽可不相同，但总和必须不超过信道总带宽，相邻信道之间需要加入保护频带；适用于传输模拟信号
  * **时分多路复用（TDM）**：将一条物理信道按时间分成若干时间片，轮流分配给多个信号使用。统计时分多路复用（STDM）不固定分配时隙，而按需动态分配；适用于传输数字信号
  * **波分多路复用（WDM）**：光的频分多路复用
  * **码分多路复用（CDM）/或码分多址（CDMA）**：采用不同的编码来区分各路原始信号，即共享信道频率，又共享时间。每个站点指派一个唯一的m位码片序列，发送1时，站点发送它的码片序列，发送0时，站点发送该码片序列的反码，**各站点码片序列相互正交**。主要用于无线通信，特别是移动通信

* 随机访问介质访问控制（争用型协议）：实际是一种将广播信道转化为点到点信道的行为

  * ALOHA协议

    * 纯ALOHA协议：可以不进行任何检测就发送数据，若一段时间未收到确认，那么该站点就认为传输过程中发生了冲突，等待一段时间后再发送
    * 时隙ALOHA协议：把所有各站在时间上同步起来，并将时间划分为一段段等长的时隙，规定只能在每个时隙开始时才能发送一个帧

  * CSMA协议（载波侦听多路访问）

    * 1-坚持CSMA：一个结点要发送数据时，首先侦听信道，若信道空闲，立即发送；若信道忙，那么等待，同时继续侦听信道直至信道空闲；若发生冲突，那么随即等待一段时间后重新开始侦听。
    * 非坚持CSMA：一个结点要发送数据时，首先侦听信道，若信道空闲，立即发送；若信道忙，放弃侦听，随即等待一个时间后重复上述过程
    * p-坚持CSMA：**用于时分信道**。一个结点要发送数据时，若信道忙，继续侦听（即推迟到下一个时隙再侦听），直至信道空闲；如果信道空闲那么以概率p发送数据，以概率1-p推迟到下一个时隙

  * CSMA/CD协议（载波侦听多路访问/碰撞检测）

    适用于总线型网络或半双工网络环境。概括为”**先听后发，边听边发，冲突停发，随即重发**“

    把以太网端到端往返时间2t称为争用期（冲突窗口或碰撞窗口）

    * **最小帧长=总线传播时延x数据传播速率x2** 
    * 以太网取51.2微秒位争用期，对于10Mb/s的以太网，争用期内可发送512bit，即64B
    * 采用二进制指数退避算法解决碰撞问题
      * 确定基本退避时间2 $\tau$ 
      * 定义参数k=min[重传次数，10]
      * 从[0，1，……，2<sup>k</sup>-1]中随机取一个数r，重传所需退避时间就是2r$\tau$
      * 当重传达16次仍失败时，认为此帧永远无法正确发出，抛弃并向高层报告出错
    
  * CSMA/CA协议（载波侦听多路访问/碰撞避免）

    802.11无线局域网使用链路层确认/重传（ARQ）方案，每通过无线局域网发送完一帧，就要在收到对方的确认帧后才能继续发送下一帧

    **所有站发送完成后，必须等待一段很短的时间才能发送下一帧，这段时间称为帧间间隔（IFS）**

    * SIFS（短IFS）：用来分隔属于一次对话的帧，使用该帧的帧类型有ACK，CTS，分片后的数据帧，以及所有回答AP探询的帧
    * PIFS（点协调IFS）
    * DIFS（分布式协调IFS）：最长的IFS，用于异步帧竞争访问的时延

    仅当检测到信道空闲且这个数据帧是要发送的第一个帧时不使用退避算法，其他所有情况都必须使用退避算法。

    **处理隐蔽站问题：RTS和CTS**

    * 源站发送数据帧前先广播一个短请求发送RTS控制帧，包括源地址、目的地址和这次通信持续时间
    * 若信道空闲，则AP广播一个允许发送CTS控制帧，它包括这次通信所需的时间（从RTS复制）
    * CTS的目的是给源站发送许可并且指示其他站点再预约期内不要发送

* 轮询访问介质访问控制

  * 令牌传递协议

    主要用于令牌环局域网，令牌是由一组特殊的比特组合而成的帧。

    轮询介质访问控制非常适合负载很高的广播信道


#### 局域网

* 以太网与IEEE802.3

  IEEE802.3标准是一种基带总线型局域网标准，通常将802.3局域网简称以太网

  * 以太网逻辑拓扑是总线型，物理拓扑是星型或拓展星型

  * 以太网只对应于OSI参考模型的数据链路层和物理层，并将数据链路层拆分为两个子层：**逻辑链路控制子层（LLC）和媒体接入控制子层（MAC）**

    * **LLC**：与传输媒体无关，向网络层提供无确认无连接、面向连接、带确认连接、高速传送四种不同的连接服务类型。主要功能包括建立和释放数据链路层的逻辑链接、提供与高层的接口、差错控制、给帧加序号
    * **MAC**：与传输媒体有关的内容都放在MAC层，主要功能包括组帧和拆卸帧、比特传输差错检测、透明传输

  * 以太网无连接、无编号、无确认

  * 使用曼切斯特编码

  * 以太网传输介质

    * 10BASE5：基带同轴粗缆
    * 10BASE2：基带同轴细缆
    * 10BASE-T：非屏蔽双绞线（UTP）——拓扑结构为星型，逻辑上是总线型
    * 10BASE-FL：光纤对

  * 网卡（网络适配器）是工作在数据链路层和物理层的网络组件，和局域网的通信通过电缆或双绞线以串行方式进行，和计算机的通信则通过计算机主板I/O总线以并行方式进行

  * MAC帧

    ![以太网V2中MAC帧格式](C:\Users\gavin\Pictures\Saved Pictures\以太网V2中MAC帧格式.jpg)

    * 地址长6字节，形如“02-06-8c-e4-b1-21”
    * 类型：指出数据域中携带的数据应交给哪个协议实体处理
    * 数据：46~1500字节，不够时填充
    * 校验码（FCS）：校验范围从目的地址到数据段末尾，采用32为CRC校验码

  * 高速以太网

    * 100BASE-T：双绞线100Mb/s，CSMA/CD，支持全双工和半双工
    * 吉比特以太网
    * 10吉比特以太网：光纤，只在全双工下工作

* IEEE802.11

  * 有固定基础设施无线局域网
    * 在MAC层使用CSMA/CA协议，又称Wi-Fi
  * 无固定基础设施移动自组网络
    * 具有自己特定的路由选择协议，可以不和因特网相连

#### 广域网

因特网的核心部分，由一些**交换机**结点及连接这些交换机的链路组成，局域网通过路由器与广域网相连；广域网使用的协议主要在网络层

* PPP（点对点）协议

  使用串行线路通信的面向字节的协议，应用在直接连接两个节点的链路上。既可以在异步线路上传输，又可在同步线路上使用

  PPP协议的组成：

  * 链路控制协议（LCP）：用于建立、配置、测试和管理数据链路
  * 网络控制协议（NCP）：为网络层协议建立和配置逻辑链接
  * 一个将IP数据报封装到串行链路的方法

  ![下载](C:\Users\gavin\Pictures\Saved Pictures\下载.png)

  **点对点协议，无需采用CSMA/CD协议，没有最短帧**

  PPP协议特点：

  * 提供差错检测但不提供纠错功能，只保证无差错接收（通过硬件进行CRC校验）；**不可靠传输协议**，不使用序号和确认机制
  * 仅支持点对点，不支持多点线路
  * 只支持全双工
  * PPP两端可运行不同网络层协议
  * 若用在异步线路，则采用字节填充法；若在同步线路，则用比特填充

* HDLC（高级数据链路控制）协议

  **不属于TCP/IP协议族**

  面向比特的数据链路层协议，使用‘0’比特插入法，全双工通信，帧采用CRC检验，对信息帧进行顺序编号，能提供可靠传输

  两种基本配置：

  * 非平衡配置：由一个主站控制整个链路工作
  * 平衡配置：链路两端都是复合站

  主站发出的帧为**命令帧**，从站发出的帧为**响应帧**

  数据操作方式：

  * 正常响应方式（非平衡结构）：主站向从站传输数据，从站响应传输，但从站只有在收到主站许可后才进行响应
  * 异步平衡方式（平衡结构）：每个复合站都可以传输数据
  * 异步响应方式（非平衡结构）：从站即使未受到主站允许也可以传输

  ![image-20211011211353160](C:\Users\gavin\AppData\Roaming\Typora\typora-user-images\image-20211011211353160.png)

  根据控制字段C的取值，HDLC帧可分为三类：

  * 信息帧（I）：传输数据信息
  * 监督帧（S）：流量控制和差错控制，对信息帧的确认、请求重发和请求暂停发送等功能
  * 无编号帧（U）：对链路的建立、拆除等

#### 数据链路层设备

* 网桥

  工作在链路层的MAC子层，可以使以太网各网段成为隔离开的碰撞域

  基本特点：

  * 必须具备寻址和路径选择能力
  * 从源网络接受帧，以目的网络的介质访问控制协议向目的网络转发
  * 在不同或相同的局域网之间存储并转发帧
  * 网桥应有足够大的缓冲空间

  优点：

  * 能过滤通信量
  * 扩大了物理范围
  * 可使用不同物理层
  * 可互联不同局域网
  * 提高了可靠性
  * 性能有改善

  缺点： 

  * 增大了延时
  * MAC子层没有流量控制
  * 不同MAC子层的网桥需要进行帧格式的转换
  * 可能产生广播风暴

### 网络层

#### 路由选择协议

* **OSPF(开放最短路径优先)**
  * 使用IP数据包
  * 链路状态路由选择协议
  * 在广播网络中，使用组播地址（而非广播）发送报文
* **RIP(路由信息协议)**
  * 使用UDP
  * 距离向量路由选择协议

#### IP数据报

> **IP协议提供不可靠无连接服务**

![5573582_1279195143KN73](C:\Users\gavin\Pictures\Saved Pictures\5573582_1279195143KN73.png)

* 版本号：IP数据报使用的IP协议版本
* 头长度：整个报头的长度，**以4B为计数单位**
* 服务类型：用于规定数据报的处理方式![5573582_1279195143SDCz](C:\Users\gavin\Pictures\Saved Pictures\5573582_1279195143SDCz.png)
  * 优先权：可以使用优先权进行拥塞控制
  * 短延迟位D：为1时请求以短延迟信道传输
  * 高吞吐量位T：为1时请求以高吞吐量信道传输
  * 高可靠位R：为1时请求以高可靠性信道传输
  * 保留位--
* 总长度：整个IP数据报的长度，以1B为单位
* 标识：唯一标识主机发送的每一份数据报
* 标志：![5573582_1279249468x0XZ](C:\Users\gavin\Pictures\Saved Pictures\5573582_1279249468x0XZ.png) 
  * DF为1时，标识数据报不能被分片，当网络MTU较小时，将产生数据不可达的错误
  * MF为1时，说明该数据报不是分片的最后一个
* 片偏移：IP数据报被分片后，各片数据区在原来IP数据区中的位置，**以8B为单位**
* 生存时间TTL：指定了数据报可以在网络中传输的最长时间。实际应用中通常设置成可以经过的最大路由器数，每经过一个路由器就减1
* 上层协议标识：传输层协议标识
* 检验和：校验协议头部字段的有效性
* 源地址：发送端IP地址
* 目的地址：目的端IP地址

#### 地址解析协议ARP

建立主机IP地址和MAC地址的映射关系（介于数据链路层与网络层之间的协议）

工作流程：

* 源主机发出ARP请求，询问目的IP的主机硬件地址，并将这个请求广播到本地网段（FF:FF:FF:FF:FF:FF）
* 目的主机接收到广播的ARP请求，发现其中的IP地址与本机相符，则发送一个ARP应答数据包给源主机，将自己的硬件地址填写在应答包中
* 每台主机维护一个ARP缓存表

**反向地址转换协议RARP**：根据MAC地址请求对应的IP地址

#### 网际控制报文协议ICMP

**ICMP报文作为IP层数据报的数据，加上IP数据报的首部组成IP数据报发送出去，是IP层的协议**

![806469-20180306123828767-1055933232](C:\Users\gavin\Pictures\Saved Pictures\806469-20180306123828767-1055933232.png)

* ICMP差错报文

  * 终点不可达
  * 源点抑制
  * 时间超过
  * 重定向

  不应发送ICMP差错报告报文的情况：

  >* 对ICMP差错报告报文不再发送
  >* 对第一个分片的数据报片的所有后续数据报不再发送
  >* 对具有多播地址的数据报不发送
  >* 对特殊地址的数据报（如127.0.0.0）不发送

* ICMP询问报文

  * 回送请求和回答报文：可用于测试目的站是否可达以及了解其有关状态（PING使用的报文）
  * 时间戳请求和回答报文：可用于时钟同步和时间测量

#### 动态主机配置协议DHCP

是**应用层协议**，工作流程：

* 客户端在局域网广播一个DHCP发现包
* DHCP服务器收到发现包后，通过发送DHCP提供包给与客户端应答
* 客户端收到提供包后，发送DHCP请求包分配IP
* DHCP服务器发送DHCP确认包，将IP分配给客户端

#### IGMP因特网组管理协议

**与ICMP一样，IGMP也被当作IP层的一部分**

当一台主机加入到一个新的组时，它发送一个IGMP消息到组地址以宣告它的成员身份，多播路由器和交换机就可以从中学习到组的成员。利用从IGMP中获取到的信息，路由器和交换机在每个接口上维护一个多播组成员的列表。

IP组播使用D类地址格式，224.0.0.0~239.255.255.255，只能用于目的地址

组播MAC地址的高24bit是以01-00-5E开头，低23bit为组播IP地址的低23bit

![image-20210902145949975](C:\Users\gavin\AppData\Roaming\Typora\typora-user-images\image-20210902145949975.png)

* 当某台主机加入新的

### 传输层

#### TCP协议

TCP报文段：

![20140609125220296](C:\Users\gavin\Pictures\Saved Pictures\20140609125220296.png)

* 源端口和目的端口：传输层的复用和分用都要通过端口实现
* 序号：本报文段所发送的数据的第一个字节的序号。tcp是面向字节流的，在tcp连接中每一个字节流都按顺序编号。
* 确认号：期望收到对方下一个报文段的第一个数据字节序号
* 数据偏移：报文段的首部长度，单位为4B。TCP首部长度最大为60B
* 保留：目前置为0
* 紧急位URG：为1表示报文段中有紧急数据，应尽快传送
* 确认位ACK：连接建立后，传输的报文段都应该置为1
* 推送位PSH：接受收到PSH=1的报文段，就尽快交付给接收应用进程，而不必等到整个缓存填满
* 复位位RST：RST=1时，表明TCP连接出现严重错误，必须释放连接，然后重新建立连接
* 同步位SYN：为1表示这是一个连接请求或连接接受报文。SYN=1,ACK=0时，表明这是一个连接请求报文，若对方同意连接，则响应报文中SYN=1.ACK=1
* 终止位FIN：用来释放连接，为1表明此报文段的发送方数据已发送完毕，并要求释放连接
* 窗口：指出当前允许对方发送的数据量，即剩余缓存空间
* 校验和：检验首部和数据，计算校验和时要在前面加上12B的伪首部
* 紧急指针：在URG=1时有意义，指出本报文段中紧急数据共有多少字节（紧急数据在报文段数据最前面）
* 选项
* 填充

**TCP连接管理**

三次握手：

![20180808105159546](C:\Users\gavin\Pictures\Saved Pictures\20180808105159546.png)

### 应用层

## 操作系统

### 计算机系统概述

#### 操作系统基本概念

操作系统是一种系统软件。基本特征包括**并发、共享、虚拟和异步**

> * 并发：两个或多个事件在同一时间间隔内发生
> * 共享：即资源共享，指系统中的资源可供内存中多个并发执行的进程共同使用。可分为以下两种方式：
>   * 互斥共享方式：在一段时间内只允许一个进程访问某些资源。这些资源称为临界资源或独占资源
>   * 同时访问方式：在一段时间内多个进程可同时访问某些资源
> * 虚拟：指把一个物理上的实体变为若干逻辑上的对应物。可分为时分复用技术和空分复用技术
> * 异步：由于资源有限，进程的执行并不是一贯到底的，而是走走停停的

操作系统应具有的功能：

>* 处理机管理：可归结为对进程的管理，主要功能包括进程控制、进程同步、进程通信、死锁处理、处理机调度等
>* 存储器管理：主要包括内存分配与回收、地址映射、内存保护与共享、内存扩充等
>* 文件管理：包括文件存储空间管理，目录管理、文件读写管理和保护等
>* 设备管理：包括缓冲管理、设备分配、设备处理和虚拟设备等

操作系统为用户提供的接口

> * 命令接口：用户利用操作命令组织和控制作业的执行
>   * 联机控制方式：交互式命令接口，适用于分时或实时系统
>   * 脱机控制方式：批处理命令接口，适用于批处理系统
> * 程序接口：由一组**系统调用**（也叫广义指令）组成

#### 操作系统的分类

* 批处理系统
  * 单道批处理系统：系统对作业处理是成批进行的，但内存中始终保持一道作业
  * 多道批处理系统：多个程序同时进入内存并允许它们在CPU中交替运行，这些程序共享系统中的各种资源
* 分时操作系统
* 实时操作系统
* 网络操作系统
* 分布式操作系统
* 个人计算机操作系统

#### 操作系统运行机制

![OS层次结构!](https://img-blog.csdnimg.cn/20200217185947163.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2xvdzUyNTI=,size_16,color_FFFFFF,t_70)

**用户栈和内核栈：**

内核创建进程时，会为进程创建相应的堆栈，一个存在于用户空间的**用户栈**和一个存在于内核空间的**内核栈**。当进程在用户空间运行时，CPU堆栈指针寄存器里的内容都是用户栈地址，进程在内核空间运行时，CPU堆栈指针寄存器里的内容都是内核栈地址。进程因中断或系统调用陷入到内核态时，进程所使用的堆栈也要从用户栈转到内核栈。陷入到内核态后，先把**用户态堆栈的地址**保存在内核栈中，然后设置堆栈指针寄存器的内容为内核栈地址。

**在进程从用户态转到内核态时，进程的内核栈总是空的**



### 进程管理

#### 进程与线程

* 进程映像由程序段、相关数据和PCB（进程控制块）构成，其中PCB是进程存在的唯一标志。进程映像是静态的，而进程是动态的。**进程是系统进行资源分配和调度的一个独立单位**

* 进程的特征

  * 动态性：进程的最基本特征
  * 并发性：指多个进程同时存在于内存，能在一段时间内同时运行
  * 独立性：指进程实体是一个能独立运行、独立获取资源和独立接受调度的基本单位
  * 异步性：进程按照各自独立的、不可预知的速度向前推进
  * 结构性：每个进程都配置一个PCB对其进行描述

* 进程状态与转换

  * 运行态：进程正在处理机上运行
  * 就绪态：进程获得了除处理机外的一切所需资源，一旦得到处理机便可立即运行
  * 阻塞态：进程正在等待某一事件而暂停运行
  * 创建态：进程正在被创建，尚未转到就绪态
  * 结束态：进程结束运行时，先置为结束态，再释放资源

  ![img](https://gimg2.baidu.com/image_search/src=http%3A%2F%2Fapi.codetool.top%2Fimg%2F15870348059720.png&refer=http%3A%2F%2Fapi.codetool.top&app=2002&size=f9999,10000&q=a80&n=0&g=0n&fmt=jpeg?sec=1633594890&t=f2723bf75ed8c7d26d46932b403f1927)

**进程从运行态转到阻塞态是主动行为，而从阻塞态到就绪态是被动行为**

* **进程控制**

  * 进程的创建：允许一个进程创建另一个进程。子进程可以继承父进程所拥有的资源，当子进程被撤销时，将其从父进程获得的资源归还给覅u进程；撤销父进程时，同时撤销其所有子进程

    操作系统创建一个新进程的过程（**创建原语**）：

    > 1. 为新进程分配唯一进程标识号，并申请一个空白PCB，若失败则创建失败
    > 2. 为进程分配资源，若失败则处于阻塞态
    > 3. 初始化PCB，主要包括标志信息、处理机状态信息、处理机控制信息以及进程优先级等
    > 4. 若就绪队列能够接纳新进程，则将其插入就绪队列

  * 进程的终止：主要有正常结束、异常结束和外界干预

    操作系统终止进程（撤销原语）：

    > 1. 根据被终止进程的标识符，检索PCB，从中读出该进程状态
    > 2. 若处于运行态，则立即终止该进程的执行，将处理机资源分配给其他进程
    > 3. 若该进程有子进程，则将其所有子进程终止
    > 4. 归还该进程拥有的全部资源
    > 5. 将PCB从所在队列删除

  * 进程阻塞和唤醒：

    （阻塞原语Block）

    > 1. 找到进程标识号对应的PCB
    > 2. 若为运行态则保护器线程，将其置为阻塞态，停止运行
    > 3. 把PCB插入相应事件的等待队列，将处理机资源调度给其他就绪进程

    （唤醒原语Wakeup）

    > 1. 在该事件的等待队列中找到相应进程的PCB
    > 2. 将其从等待队列移出，并置为就绪态
    > 3. 把PCB插入就绪队列，等待调度程序调度

    Block和Wakeup原语必须成对使用

  * 进程切换

    > 1. 保存处理机上下文，包括程序计数器和其他寄存器
    > 2. 更新PCB信息
    > 3. 把进程PCB移入相应队列
    > 4. 选择另一个进程执行，并更新其PCB
    > 5. 更新内存管理的数据结构
    > 6. 恢复处理机上下文

    **调度和切换的区别**：调度指决定资源分配给哪个进程，是一种决策行为；切换是指实际分配的行为，是一种执行行为。

* **进程的组织**

  * 进程控制块PCB：

    > 1. 进程描述信息：包括进程标识符和用户标识符
    > 2. 进程控制和管理信息：进程当前状态、进程优先级、代码运行入口地址、程序外存地址、进入内存时间、处理及占用时间、信号量使用
    > 3. 资源分配清单：代码段指针、数据段指针、堆栈段指针、文件描述符、键盘鼠标等
    > 4. 处理机相关信息：通用寄存器值、地址寄存器值、控制寄存器值、标志寄存器值、状态字

    PCB组织方式：

    * 链接方式：将同一状态的PCB链接成一个队列
    * 索引方式：将同一状态的PCB组织在一个索引表中

  * 程序段：能被进程调度程序调度到CPU执行的程序代码段

  * 数据段：可以是进程对应的程序加工处理的原始数据，也可以是程序执行时产生的中间或最终结果

* **进程的通信**

  * 共享存储：通信的进程间存在一块可直接访问的共享空间，通过对这片共享空间的读/写操作实现进程间的信息交换。**对共享空间的读写需要用到同步互斥工具**
  * 消息传递：进程间数据交换以格式化的消息为单位。
    * 直接通信方式：发送进程直接发给接收进程，并将其挂在接受进程的消息缓冲队列上
    * 间接通信方式：发送进程把消息发送到某个中间实体，接收进程从中间实体取得消息，中间实体一般称为信箱
  * 管道通信：管道指用于连接一个读进程和一个写进程以实现它们之间通信的一个共享文件。写进程以字符流形式将大量数据写入管道，都进程从管道读数据。**管道机制必须提供互斥、同步和确认对方存在的协调能力；管道读数据是一次性读取，数据一旦被读取它就从管道中被抛弃；管道只能采用半双工通信**

* **多线程模型**

  * **线程**：是一个基本的CPU执行单元，也是程序执行流的最小单元，由线程ID、程序计数器、寄存器集合和堆栈组成。线程不拥有系统资源，但可与统一进程内的其他线程共享进程的全部资源。线程是**系统独立调度和分配的基本单位**

  * 线程的实现方式

    > * 用户级线程：由应用程序所支持的线程实现, 内核意识不到用户级线程的实现
    > * 内核级线程：又称为内核支持的线程

  * 多线程模型：

    * 多对一模型：多个用户级线程映射到一个内核级线程，线程管理在用户空间完成
    * 一对一模型：每个用户级线程都有一个内核级线程映射
    * 多对多模型：n个用户级线程映射到m个内核级线程（m<=n）



#### 处理机调度

* 调度层次
  * 作业调度（高级调度）：内存与辅存之间的调度，按一定原则从外村上处于后备状态的作业中挑选一个或多个作业，给它分配内存、输入输出设备等必要资源，并建立相应进程
  * 内存调度（中级调度）：将暂时不能运行的进程调至外存等待，进程变为阻塞态，当进程已具备运行条件且内存稍有空闲时，再将其重新调入内存并修改其状态为就绪态
  * 进程调度（低级调度）：是最基本的调度，按某种策略从就绪队列中选取一个进程将处理机分配给它。一般几十毫秒一次

![AoAfQP](C:\Users\gavin\Pictures\Saved Pictures\AoAfQP.png)

* 进程调度时机

  以下情况不能进行进程调度与切换：

  > * 在处理中断过程中
  > * 进程在操作系统内核程序临界区中
  > * 其他需要完全屏蔽中断的原子操作过程中

  进程切换往往在调度完成后立刻发生，操作系统内核将原进程的现场信息推入当前进程的内核堆栈来保存它们，并更新堆栈指针。

* 进程调度方式

  * 非剥夺调度方式（非抢占方式）：

#### 管程

信号量机制虽然是一种既方便又有效的进程同步机制，但是每个访问理解资源的进程都必须自备同步操作，不仅给系统管理带来麻烦，还很容易因同步操作不当造成系统死锁。

代表系统共享资源的数据结构，以及有对该共享数据结构实施操作的一组过程所组成的资源管理程序，共同构成一个操作系统的资源管理模块，称之为“管程”

#### 死锁



### 内存管理

#### 程序装入与链接



#### 逻辑地址与物理空间

#### 内存保护



### [文件管理](https://blog.51cto.com/u_15169172/3240277)

#### 文件系统

**文件**

文件是以计算机硬盘为载体的存储在计算机上的信息集合，可以是文本文档、图片、程序等。**系统运行时，计算机以进程为基本单位进行资源调度和分配；而在用户进行的输入输出中，则以文件为基本单位**

**文件目录**

![25eb0dbb8182ec7aa7a5fa431d22b709](C:\Users\gavin\Pictures\Saved Pictures\25eb0dbb8182ec7aa7a5fa431d22b709.jpeg)

* 文件控制块（FCB）:

  ![image-20210917171659729](C:\Users\gavin\AppData\Roaming\Typora\typora-user-images\image-20210917171659729.png)

  * 搜索：系统根据文件名搜索目录找到文件对应的目录项
  * 创建文件：在其所属的目录中增加一个目录项
  * 删除文件：在目录中删除相应的目录项
  * 显示目录：显示目录中所有文件以及相应属性
  * 修改目录：修改相应目录项

  <img src="C:\Users\gavin\Pictures\Saved Pictures\02003363da779bf391350cbbcd681762.jpeg" alt="02003363da779bf391350cbbcd681762" style="zoom:50%;" />

* 







#### 磁盘

![fa2056026b261cc52e2b422a7dba4245](C:\Users\gavin\Pictures\Saved Pictures\fa2056026b261cc52e2b422a7dba4245.jpeg)

**磁盘初始化**

* 进行低级格式化（物理格式化）：将磁盘各个磁道划分为扇区。扇区可分为头、数据区和尾三个部分。管理扇区的各种数据结构一般存放于头尾两个部分。

* 将磁盘分区，每个分区由若干柱面组成

  <img src="C:\Users\gavin\Pictures\Saved Pictures\73fd3843de6162359a56ba9d735f65c8.jpeg" alt="73fd3843de6162359a56ba9d735f65c8" style="zoom:50%;" />

* 进行逻辑格式化，创建文件系统。包括文件系统的根目录、初始化空闲空间管理的数据结构（如位示图、空闲分区表）

**引导块（启动块）**

计算机开机时进行的一系列初始化工作是由**自举程序**完成的。完整的自举程序放在磁盘的启动块上，启动块位于磁盘的固定位置，拥有启动分区的磁盘成为系统磁盘（C盘）

ROM寄存器中只存放很小的“自举装入程序”，开机时通过运行该程序就可找到引导块，并将完整的自举程序读入内存。

**磁盘调度算法**

* FCFS先来先服务算法
  * 优点：公平
  * 缺点：性能差
* SSTF最短寻道时间有限算法：
  * 优点：性能较好，平均寻道时间短
  * 缺点：可能产生饥饿现象
* SCAN扫描算法（电梯算法）:
  * 优点：性能较好，平均寻道时间较短，不会产生饥饿现象
  * 缺点：对各个磁道的响应频率不平均
* LOOK算法：
  * 优点：与SCAN相比，不许每次都移动到最外或最内侧，进一步缩短了寻道时间
* C-SCAN循环扫描算法：
  * 优点：与SCAN相比，对各磁道的响应频率很平均
* C-LOOK算法

**文件分配**

* 连续分配

  * 优点：支持顺序访问和随机访问；连续分配的文件在顺序访问时速度最快
  * 缺点：不方便文件拓展，存储空间利用率低，会产生磁盘碎片

* 非连续分配

  1. 隐式链接

     ![818fffca60633b3485ca521d2ed8f18c](C:\Users\gavin\Pictures\Saved Pictures\818fffca60633b3485ca521d2ed8f18c.jpeg)

     * 优点：方便文件扩展，所有空闲块都可以被利用
     * 缺点：只支持顺序访问，不支持随机访问，查找效率低。指向下一个盘块的指针也需要耗费少量空间

  2. 显示链接

     一个磁盘仅设置一张FAT（文件分配表），开机时将FAT读入内存并常驻内存。FAT的各个表项在物理上连续存储，且每个表项长度相同，因此物理块号可以隐含。逻辑块号转换成物理块号的过程不需要读磁盘操作。

     * 优点：支持顺序访问和随机访问，访问速度比隐式链接快
     * 缺点：文件分配表需要占用一定空间

* 索引分配

  系统为每个文件建立一张索引表，索引表中记录了文件的各个逻辑块对应的物理块。索引表存放的磁盘块称为索引块，文件数据存放的磁盘块称为数据块。

  <img src="C:\Users\gavin\Pictures\Saved Pictures\818fffca60633b3485ca521d2ed8f18c.jpeg" alt="818fffca60633b3485ca521d2ed8f18c" style="zoom:50%;" />

  * 优点：支持随机访问，文件易拓展
  * 缺点：索引表项需要占用一定存储空间

* 索引分配-链接方式

  如果索引表太大，一个索引块装不下，可以将多个索引块链接起来存放

  <img src="C:\Users\gavin\Pictures\Saved Pictures\e2b84fcdbdc31c1039ddf547f9be045a.jpeg" alt="e2b84fcdbdc31c1039ddf547f9be045a" style="zoom:50%;" />

  * 优点：支持大型文件
  * 缺点：文件很大时非常低效，需要一直遍历链表

* 索引分配-多级索引

  <img src="C:\Users\gavin\Pictures\Saved Pictures\36481acfe5a6041038d432eba62f7777.jpeg" alt="36481acfe5a6041038d432eba62f7777" style="zoom:50%;" />

* 索引分配-混合索引

  <img src="C:\Users\gavin\Pictures\Saved Pictures\fba9aab85cf0e785524f18393df95168.jpeg" alt="fba9aab85cf0e785524f18393df95168" style="zoom:50%;" />

**空闲空间管理**

* **空闲表法**

  适用于连续分配

  <img src="C:\Users\gavin\Pictures\Saved Pictures\36b1e058e31209715dcd13ea12d6ca2e.jpeg" alt="36b1e058e31209715dcd13ea12d6ca2e" style="zoom:50%;" />

* **空闲链表法**

  操作系统保存着链头、链尾指针

  1. 空闲盘块链：以盘块为单位组成一条空闲链；

  2. 空闲盘区链：以盘区为单位组成一条空闲链

     <img src="C:\Users\gavin\Pictures\Saved Pictures\bc187f8530c2b16a2782a018d18440fc.jpeg" alt="bc187f8530c2b16a2782a018d18440fc" style="zoom:50%;" />

* **位示图法**

  连续分配、离散分配都适用

  每个二进制位对应一个盘块，0代表空闲，1代表已分配

* **成组链接法**

  [参考](http://www.360doc.com/content/19/1013/16/66412393_866552145.shtml)

  文件卷的目录区中专门用一个磁盘块作为“超级块”，当系统启动时需要将超级块读入内存。并保证内存与外存中超级块数据一致
  
  <img src="C:\Users\gavin\Pictures\Saved Pictures\32dab1f2f7ceffd880bf2717e3083fa0.jpeg" alt="32dab1f2f7ceffd880bf2717e3083fa0" style="zoom:50%;" />



#### RAID独立瓷盘冗余阵列

![image-20211022112354335](C:\Users\gavin\AppData\Roaming\Typora\typora-user-images\image-20211022112354335.png)

## 计算机结构与组成

### 计算机系统概述

#### 计算机系统层次结构

计算机硬件和计算机软件共同组成了一个完整的计算机系统。

* 冯诺依曼机：以存储程序概念为基础的计算机，其特点为：
  * 计算机硬件系统由运算器、存储器、控制器、输入设备和输出设备5大部件组成
  * 指令和数据以同等地位存储在存储器中，并可按地址寻访
  * 



#### 计算机性能指标

* 机器字长

  指计算机进行一次整数运算所能处理的二进制数据的位数，通常与CPU的寄存器位数、加法器有关。（一般等于内部寄存器大小，字长越长数的表示范围越大，计算精度越高）

* 数据通路带宽

  数据总线一次所能并行传送到信息位数

* 主存容量

  主存储器所能存储信息的最大容量

* 运算速度

  * 吞吐量：系统在单位时间内处理请求的数量，主要取决于主存的存取周期

  * 响应时间：用户向计算机发送一个请求，到系统对该请求做出响应并获得所需结果的等待时间。包括CPU时间和等待时间

  * CPU时钟周期：CPU中最小的时间单位，执行一个指令至少需要1个时钟周期

  * 主频（CPU时钟频率）：机器内部主时钟的频率，与时钟周期互为倒数

  * CPI：执行一条指令所需的时钟周期数

  * CPU执行时间：运行一个程序所花费的时间

    ```
    CPU执行时间=CPU时钟周期数/主频=（指令条数xCPI）/主频
    ```

  * MIPS：每秒执行多少百万条指令

    ```
    MIPS=指令条数/(执行时间x10^6)=主频/(CPIx10^6)
    ```

  * MFLOPS……：每秒执行多少次浮点运算

* 基准程序

  专门用来进行性能评价的一组程序

  

### MIPS指令集

#### MIPS寄存器

MIPS包含32个通用寄存器

![20190106211619686](C:\Users\gavin\Pictures\Saved Pictures\20190106211619686.png)



[看看](https://blog.csdn.net/qq_41191281/article/details/85933985)



### 地址映射

![](https://static.oschina.net/uploads/img/201803/07163541_gEDQ.png)

